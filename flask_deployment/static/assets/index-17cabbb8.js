import{r as d,a as M,R as K}from"./vendor-b1791c80.js";import{a as i}from"./http-edfcd65b.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function f(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=f(s);fetch(s.href,r)}})();var A={exports:{}},N={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y=d,J=Symbol.for("react.element"),V=Symbol.for("react.fragment"),G=Object.prototype.hasOwnProperty,H=Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Q={key:!0,ref:!0,__self:!0,__source:!0};function I(h,o,f){var n,s={},r=null,u=null;f!==void 0&&(r=""+f),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(u=o.ref);for(n in o)G.call(o,n)&&!Q.hasOwnProperty(n)&&(s[n]=o[n]);if(h&&h.defaultProps)for(n in o=h.defaultProps,o)s[n]===void 0&&(s[n]=o[n]);return{$$typeof:J,type:h,key:r,ref:u,props:s,_owner:H.current}}N.Fragment=V;N.jsx=I;N.jsxs=I;A.exports=N;var e=A.exports,R={},C=M;R.createRoot=C.createRoot,R.hydrateRoot=C.hydrateRoot;i.defaults.baseURL={}.VITE_API_URL||"http://localhost:3000";function X(){const[h,o]=d.useState(null),[f,n]=d.useState([]),[s,r]=d.useState(!1),[u,m]=d.useState(""),[j,g]=d.useState(""),[P,y]=d.useState(!1),[W,v]=d.useState(!1),[b,S]=d.useState({email:"",password:""}),[w,L]=d.useState({email:"",password:""}),[x,O]=d.useState(!1);d.useEffect(()=>{const t=localStorage.getItem("token");t&&(i.defaults.headers.common.Authorization=`Bearer ${t}`,$())},[]);const $=async()=>{try{const t=await i.get("/api/auth/verify");o(t.data.user),y(!0),_()}catch{localStorage.removeItem("token"),delete i.defaults.headers.common.Authorization,y(!1)}},_=async()=>{try{const t=await i.get("/api/oauth/status");v(t.data.connected)}catch(t){console.error("OAuth status check failed:",t)}},D=async t=>{var c,a;t.preventDefault(),r(!0),m("");try{const l=await i.post("/api/auth/login",b),{token:p,user:k}=l.data;localStorage.setItem("token",p),i.defaults.headers.common.Authorization=`Bearer ${p}`,o(k),y(!0),g("Login successful!"),S({email:"",password:""}),_()}catch(l){m(((a=(c=l.response)==null?void 0:c.data)==null?void 0:a.error)||"Login failed")}finally{r(!1)}},F=async t=>{var c,a;t.preventDefault(),r(!0),m("");try{const l=await i.post("/api/auth/register",w),{token:p,user:k}=l.data;localStorage.setItem("token",p),i.defaults.headers.common.Authorization=`Bearer ${p}`,o(k),y(!0),g("Registration successful!"),L({email:"",password:""}),O(!1)}catch(l){m(((a=(c=l.response)==null?void 0:c.data)==null?void 0:a.error)||"Registration failed")}finally{r(!1)}},T=()=>{localStorage.removeItem("token"),delete i.defaults.headers.common.Authorization,o(null),y(!1),v(!1),n([]),g("Logged out successfully")},z=async()=>{try{const t=await i.get("/api/oauth/authorize");window.location.href=t.data.oauth_url}catch{m("Failed to initiate eWeLink connection")}},B=async()=>{try{await i.post("/api/oauth/disconnect"),v(!1),n([]),g("eWeLink account disconnected")}catch{m("Failed to disconnect eWeLink account")}},E=async()=>{var t,c;r(!0),m("");try{const a=await i.get("/api/tenant/devices");n(a.data.devices),g(`Loaded ${a.data.devices.length} devices`)}catch(a){((c=(t=a.response)==null?void 0:t.data)==null?void 0:c.code)==="EWELINK_NOT_CONNECTED"?m("Please connect your eWeLink account first"):m("Failed to fetch devices")}finally{r(!1)}},U=async(t,c)=>{var a,l;r(!0),m("");try{await i.post(`/api/tenant/devices/${t}/control`,{params:c}),g(`Device ${t} controlled successfully`),setTimeout(E,1e3)}catch(p){m(`Failed to control device: ${((l=(a=p.response)==null?void 0:a.data)==null?void 0:l.error)||p.message}`)}finally{r(!1)}},q=t=>{var l;const a=(((l=t.params)==null?void 0:l.switch)||"off")==="on"?"off":"on";U(t.deviceid,{switch:a})};return d.useEffect(()=>{const t=new URLSearchParams(window.location.search),c=t.get("oauth_success"),a=t.get("oauth_error");c?(g("eWeLink account connected successfully!"),v(!0),window.history.replaceState({},document.title,window.location.pathname)):a&&(m(`OAuth error: ${a}`),window.history.replaceState({},document.title,window.location.pathname))},[]),P?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("nav",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"eWeLink MCP Server"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Welcome, ",h==null?void 0:h.email]}),e.jsx("button",{onClick:T,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Logout"})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[u&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:u}),j&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:j}),e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("div",{className:"border-4 border-dashed border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"eWeLink Integration"}),W?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full mr-2"}),e.jsx("span",{className:"text-green-700 font-medium",children:"eWeLink Connected"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:E,disabled:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium disabled:opacity-50",children:s?"Loading...":"Refresh Devices"}),e.jsx("button",{onClick:B,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Disconnect"})]})]}),f.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Your Devices"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(t=>{var c,a;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.online?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.online?"Online":"Offline"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Type: ",t.type]}),((c=t.params)==null?void 0:c.switch)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Status: ",t.params.switch==="on"?"On":"Off"]}),e.jsxs("button",{onClick:()=>q(t),disabled:!t.online||s,className:`px-3 py-1 rounded text-sm font-medium disabled:opacity-50 ${t.params.switch==="on"?"bg-red-100 text-red-800 hover:bg-red-200":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:["Turn ",t.params.switch==="on"?"Off":"On"]})]}),((a=t.params)==null?void 0:a.bright)&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-gray-700",children:["Brightness: ",t.params.bright,"%"]})})]},t.deviceid)})})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Connect your eWeLink account to manage your smart home devices."}),e.jsx("button",{onClick:z,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium",children:"Connect eWeLink Account"})]})]})})]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"eWeLink MCP Server"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:x?"Create your account":"Sign in to your account"})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[u&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:u}),j&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:j}),e.jsxs("form",{onSubmit:x?F:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:x?w.email:b.email,onChange:t=>{x?L({...w,email:t.target.value}):S({...b,email:t.target.value})},className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",required:!0,value:x?w.password:b.password,onChange:t=>{x?L({...w,password:t.target.value}):S({...b,password:t.target.value})},className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:s,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:s?"Please wait...":x?"Register":"Sign in"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>O(!x),className:"w-full text-center text-sm text-blue-600 hover:text-blue-500",children:x?"Already have an account? Sign in":"Need an account? Register"})})]})})]})}R.createRoot(document.getElementById("root")).render(e.jsx(K.StrictMode,{children:e.jsx(X,{})}));
//# sourceMappingURL=index-17cabbb8.js.map
